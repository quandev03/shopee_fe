{"ast":null,"code":"import { isTag } from 'domhandler';\nimport { Picker } from 'selderee';\nfunction hp2Builder(nodes) {\n  return new Picker(handleArray(nodes));\n}\nfunction handleArray(nodes) {\n  const matchers = nodes.map(handleNode);\n  return (el, ...tail) => matchers.flatMap(m => m(el, ...tail));\n}\nfunction handleNode(node) {\n  switch (node.type) {\n    case 'terminal':\n      {\n        const result = [node.valueContainer];\n        return (el, ...tail) => result;\n      }\n    case 'tagName':\n      return handleTagName(node);\n    case 'attrValue':\n      return handleAttrValueName(node);\n    case 'attrPresence':\n      return handleAttrPresenceName(node);\n    case 'pushElement':\n      return handlePushElementNode(node);\n    case 'popElement':\n      return handlePopElementNode(node);\n  }\n}\nfunction handleTagName(node) {\n  const variants = {};\n  for (const variant of node.variants) {\n    variants[variant.value] = handleArray(variant.cont);\n  }\n  return (el, ...tail) => {\n    const continuation = variants[el.name];\n    return continuation ? continuation(el, ...tail) : [];\n  };\n}\nfunction handleAttrPresenceName(node) {\n  const attrName = node.name;\n  const continuation = handleArray(node.cont);\n  return (el, ...tail) => Object.prototype.hasOwnProperty.call(el.attribs, attrName) ? continuation(el, ...tail) : [];\n}\nfunction handleAttrValueName(node) {\n  const callbacks = [];\n  for (const matcher of node.matchers) {\n    const predicate = matcher.predicate;\n    const continuation = handleArray(matcher.cont);\n    callbacks.push((attr, el, ...tail) => predicate(attr) ? continuation(el, ...tail) : []);\n  }\n  const attrName = node.name;\n  return (el, ...tail) => {\n    const attr = el.attribs[attrName];\n    return attr || attr === '' ? callbacks.flatMap(cb => cb(attr, el, ...tail)) : [];\n  };\n}\nfunction handlePushElementNode(node) {\n  const continuation = handleArray(node.cont);\n  const leftElementGetter = node.combinator === '+' ? getPrecedingElement : getParentElement;\n  return (el, ...tail) => {\n    const next = leftElementGetter(el);\n    if (next === null) {\n      return [];\n    }\n    return continuation(next, el, ...tail);\n  };\n}\nconst getPrecedingElement = el => {\n  const prev = el.prev;\n  if (prev === null) {\n    return null;\n  }\n  return isTag(prev) ? prev : getPrecedingElement(prev);\n};\nconst getParentElement = el => {\n  const parent = el.parent;\n  return parent && isTag(parent) ? parent : null;\n};\nfunction handlePopElementNode(node) {\n  const continuation = handleArray(node.cont);\n  return (el, next, ...tail) => continuation(next, ...tail);\n}\nexport { hp2Builder };","map":{"version":3,"names":["isTag","Picker","hp2Builder","nodes","handleArray","matchers","map","handleNode","el","tail","flatMap","m","node","type","result","valueContainer","handleTagName","handleAttrValueName","handleAttrPresenceName","handlePushElementNode","handlePopElementNode","variants","variant","value","cont","continuation","name","attrName","Object","prototype","hasOwnProperty","call","attribs","callbacks","matcher","predicate","push","attr","cb","leftElementGetter","combinator","getPrecedingElement","getParentElement","next","prev","parent"],"sources":["/Volumes/MAC_Quandev03/Code/JS/ShopeeClone/ShopeeClone/node_modules/@selderee/plugin-htmlparser2/lib/hp2-builder.mjs"],"sourcesContent":["import { isTag } from 'domhandler';\nimport { Picker } from 'selderee';\n\nfunction hp2Builder(nodes) {\n    return new Picker(handleArray(nodes));\n}\nfunction handleArray(nodes) {\n    const matchers = nodes.map(handleNode);\n    return (el, ...tail) => matchers.flatMap(m => m(el, ...tail));\n}\nfunction handleNode(node) {\n    switch (node.type) {\n        case 'terminal': {\n            const result = [node.valueContainer];\n            return (el, ...tail) => result;\n        }\n        case 'tagName':\n            return handleTagName(node);\n        case 'attrValue':\n            return handleAttrValueName(node);\n        case 'attrPresence':\n            return handleAttrPresenceName(node);\n        case 'pushElement':\n            return handlePushElementNode(node);\n        case 'popElement':\n            return handlePopElementNode(node);\n    }\n}\nfunction handleTagName(node) {\n    const variants = {};\n    for (const variant of node.variants) {\n        variants[variant.value] = handleArray(variant.cont);\n    }\n    return (el, ...tail) => {\n        const continuation = variants[el.name];\n        return (continuation) ? continuation(el, ...tail) : [];\n    };\n}\nfunction handleAttrPresenceName(node) {\n    const attrName = node.name;\n    const continuation = handleArray(node.cont);\n    return (el, ...tail) => (Object.prototype.hasOwnProperty.call(el.attribs, attrName))\n        ? continuation(el, ...tail)\n        : [];\n}\nfunction handleAttrValueName(node) {\n    const callbacks = [];\n    for (const matcher of node.matchers) {\n        const predicate = matcher.predicate;\n        const continuation = handleArray(matcher.cont);\n        callbacks.push((attr, el, ...tail) => (predicate(attr) ? continuation(el, ...tail) : []));\n    }\n    const attrName = node.name;\n    return (el, ...tail) => {\n        const attr = el.attribs[attrName];\n        return (attr || attr === '')\n            ? callbacks.flatMap(cb => cb(attr, el, ...tail))\n            : [];\n    };\n}\nfunction handlePushElementNode(node) {\n    const continuation = handleArray(node.cont);\n    const leftElementGetter = (node.combinator === '+')\n        ? getPrecedingElement\n        : getParentElement;\n    return (el, ...tail) => {\n        const next = leftElementGetter(el);\n        if (next === null) {\n            return [];\n        }\n        return continuation(next, el, ...tail);\n    };\n}\nconst getPrecedingElement = (el) => {\n    const prev = el.prev;\n    if (prev === null) {\n        return null;\n    }\n    return (isTag(prev)) ? prev : getPrecedingElement(prev);\n};\nconst getParentElement = (el) => {\n    const parent = el.parent;\n    return (parent && isTag(parent)) ? parent : null;\n};\nfunction handlePopElementNode(node) {\n    const continuation = handleArray(node.cont);\n    return (el, next, ...tail) => continuation(next, ...tail);\n}\n\nexport { hp2Builder };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}